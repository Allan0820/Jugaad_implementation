#!/bin/bash
  
echo "This is a shell script"
no_of_cores="$(cat /proc/cpuinfo | grep processor | wc -l)"
echo "$no_of_cores"
total_pcaps="$(ls -p ../../../MasterData/enp2s0/ | wc -l)"

pcap_each_batch=$(($total_pcaps/$no_of_cores))
echo "$pcap_each_batch"

for ((i=0;i<$no_of_cores;i++))
do
   mkdir batch_$i
   if [ $i -eq 15 ]
   then
	 pcap_each_batch=$(($pcap_each_batch+$(($total_pcaps%$no_of_cores))))
   fi
   #for file in $(ls -p ../../../MasterData/enp2s0/ | grep -v / | tail -"$pcap_each_batch")
   for file in $(ls -p ../../../MasterData/enp2s0/ | tail -"$pcap_each_batch")
   do
      mv ../../../MasterData/enp2s0/$file ./batch_$i/
      # cp ./temp_$i/* ./processed/
   done
      taskset -c $i python cleanup.py ./batch_$i/ ../../Master_data_selected_3348/ &
done

#for ((i=0;i<=$no_of_cores;i++))
#do
#   mkdir batch_$i
#   for file in $(ls -p ../Data_First_100_selected/ | grep -v / | tail -$pcap_each_batch)
#   do
#   cp ../Data_First_100_selected/$file ./batch_$i/
#   done
#   taskset -c $i python generaltest.py ../Data_First_100_selected/ ./custom_scripts/ ./log_output/ &
#   echo "Welcome $i times"
#done
