import os
import subprocess
import sys
import os.path

def merge_pcap():

	print("Merging the pcap files")

	all_datasets_folder = "allan_outputs/network_raw_data/"
	merged_folder = "allan_outputs/bro_input/"
	checkingfolder = "allan_outputs/bro_done/"

	all_datasets = os.listdir(all_datasets_folder)
	print(all_datasets)
	datasets_selected_paths = []

	for dataset_folder in all_datasets:
		datasets = os.listdir(all_datasets_folder + "/" + dataset_folder)
		print("inside the dataset function")
		list_contains_ips = []
		no_of_contains_ips = []
		list_contains_ext_ips = []
		
		for dataset in datasets:
			print (dataset)
			path1 = all_datasets_folder + "/" + dataset_folder + "/" + dataset
			os.system("cp " + path1 + " " + merged_folder)
	print("Merged files in ", merged_folder )


merge_pcap()

data = "allan_outputs/bro_input/"
broscripts = "Bro_Inbuild_Scripts/"
genlogs = "./allan_outputs/bro_output/"
done_path = "allan_outputs/bro_done/"

datasets=os.listdir(data)
scripts=os.listdir(broscripts)
nofdata=len(datasets)

i=1
subprocess.call(["ls","-l"])

for dataset in datasets :
	name=dataset
	print ()
	print (i, ". ", name )
	path=genlogs+"/"+name
	
	subprocess.call(["zeek","-r",data+"/"+dataset])
	subprocess.call([f"mv *.log {genlogs}"])

	subprocess.call(["mv",data+"/"+dataset,done_path+"/"])
	print ("Finished set " )
	print ("Completed " + str(i) + " datsasets out of " + str(nofdata))
	print ("######################################")
	i=i+1


